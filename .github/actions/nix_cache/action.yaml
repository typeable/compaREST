name: "Nix cache"
description: "Cache nix build"
inputs:
  key:
    description: "Caching key"
    required: true
  restore-keys:
    description: "Restore keys"
    required: false
    default: ""
runs:
  using: "composite"
  steps:
    - name: Cache Nix
      id: cache-nix
      uses: actions/cache@v2.1.7
      with:
        path: |
          ~/nix
        key: ${{ inputs.key }}
        restore-keys: ${{ inputs.restore-keys }}
    - name: Move nix store
      shell: bash
      env:
        CACHE_HIT: ${{ steps.cache-nix.outputs.cache-hit }}
      run: |
        if [[ "$CACHE_HIT" == 'true' ]]; then
          sudo mkdir -p /nix
          sudo mv -f ~/nix/* /nix/
        fi
